#!/usr/bin/env bash

source ./develop/shared/functions.bash

statusmsg -ns "Hi! Welcome to Eave. I will help you setup this repository."
statusmsg -i "Before getting started, it is recommended to install the "nvm" and "pyenv" version management tools into your environment."

echo ""

usershell=$(shellname)

case $usershell in
    "bash" | "zsh")
        case $usershell in
            "bash") loginfile="~/.bashrc";;
            "zsh") loginfile="~/.zshrc";;
        esac
        varcmd="export EAVE_HOME=\"$(pwd)\""
        statusmsg -ni "First, I'll add the following line to $loginfile:"
        echo ""
        statusmsg -o "\t$varcmd"
        echo ""

        read -p "Should I proceed? [y/n] " proceed
        if test "$proceed" = "y"
        then
            echo -e "\n$varcmd" >> $loginfile
        fi
        ;;
    "fish")
        varcmd="set -Ux EAVE_HOME $(pwd)"
        statusmsg -ni "First, I'll add a Universal variable to your Fish environment with the following command:"
        echo ""
        echo -e "\t$varcmd"
        echo ""

        read -p "Should I proceed? [y/n] " proceed
        if test "$proceed" = "y"
        then
            fish -c "$varcmd"
        fi
        ;;
    *)
        statusmsg -w "Your shell ($usershell) isn't supported by this script. Please update this script to add support!"
        ;;
esac

echo ""

statusmsg -ni "Next, I'm going to visit each of the app directories and run the setup script for each one."

read -p "Should I proceed? [y/n] " proceed
if test "$proceed" = "y"
then
    statusmsg -i "setting up apps/core..."
    cd apps/core
    bin/setup

    statusmsg -i "setting up apps/slack..."
    cd ../slack
    bin/setup

    statusmsg -i "setting up apps/github..."
    cd ../github
    bin/setup

    statusmsg -i "setting up apps/jira..."
    cd ../jira
    bin/setup

    statusmsg -i "setting up apps/marketing..."
    cd ../marketing
    bin/setup

    cd ../../
fi

statusmsg -s "Done!"

statusmsg -i "Now, open the file .vscode/eave.code-workspace in VSCode, and you're ready to go."
