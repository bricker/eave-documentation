#!/usr/bin/env bash

set -eu

source ${EAVE_HOME}/develop/functions.bash

function setup () (
	python-validate-version
	python-activate-venv

	local piploc=""
	if -n "${CI:-}"; then
		piploc="--user"
	fi

	local qflag="-q"
	if verbose; then
		qflag=""
	fi
	statusmsg -i "Setting up python..."

	if test -f requirements.txt
	then
		python -m pip install $qflag $piploc -r requirements.txt
	fi

	if test -f requirements-dev.txt
	then
		python -m pip install $qflag $piploc -r requirements-dev.txt
	fi

	python -m pip install $qflag $piploc \
		-r ${EAVE_HOME}/develop/python/requirements-dev.txt \
		-r ${EAVE_HOME}/libs/eave-stdlib-py/requirements-dev.txt \
		-r ${EAVE_HOME}/libs/eave-pubsub-schemas/requirements-dev.txt

	statusmsg -s "Python setup completed âœ”"
)

setup